# 链接转附件 字段捷径插件

## 插件简介

本插件支持将网络链接一键转换为飞书附件格式，自动识别文件类型并生成对应的附件。适用于文档收集、资源整理、链接管理等场景，极大提升链接资源的组织和管理效率。

## 功能特性
- 支持从文本中自动提取网络链接（http/https）
- 智能文件类型检测，支持多种文件格式识别
- 自动过滤超大文件（25MB限制），确保系统稳定性
- 支持批量处理（最多5个链接）
- 详细日志输出，便于排查和追踪
- 支持多种CDN域名，兼容性强

## 使用方法

### 安装依赖
```bash
npm install
```

### 本地开发与测试
```bash
npm run start    # 启动开发服务
npm run build    # 构建插件
npm run pack     # 打包生成 output/output.zip
```

### 字段输入格式说明
- **文本字符串**：包含网络链接的文本内容，插件会自动提取其中的 http/https 链接
- **文本数组**：`[{ type: 'text', text: '...' }, ...]`，自动拼接后提取链接
- **URL字段**：直接传入链接地址

### 输出
- 成功时返回转换后的附件数组，每个附件包含文件名和链接地址
- 自动识别文件类型并添加对应扩展名
- 失败时返回详细错误信息

## 关键代码说明
主逻辑位于 `src/index.ts`：
- 使用正则表达式自动提取文本中的链接
- 通过 HEAD 请求获取文件信息和类型
- 使用 file-type 库进行文件类型检测
- 支持多种文件格式的智能识别
- 文件大小限制和错误处理机制
- 日志详细记录处理过程，便于开发和线上排查

## 目录结构
```
src/
├── index.ts        # 主入口，处理所有上传逻辑
├── ...             # 其他辅助文件
output/
└── output.zip      # 打包后产物
```

## 文件类型支持
插件支持自动识别以下文件类型：
- **文档类型**：HTML、PDF、TXT、CSS、JS、JSON
- **图片类型**：JPG、PNG、GIF、WebP、SVG
- **音视频**：MP4、WebM、MP3、WAV
- **压缩文件**：ZIP、RAR
- **Office文档**：DOC、DOCX、XLS、XLSX
- **其他类型**：自动检测或标记为通用文件

## 常见问题
- 单个文件大小限制为25MB，超过限制的文件会被自动过滤
- 最多同时处理5个链接，超出部分会被忽略
- 如果链接无法访问或文件类型无法识别，会使用默认的 `.file` 扩展名
- 处理失败请查看日志输出，检查链接有效性和网络连接

## 版权信息
- 开发者：wycbug
- 插件类型：字段捷径插件（Faas 版本）
- 发布范围：全量发布

如需定制或有其他需求，欢迎联系开发者。
